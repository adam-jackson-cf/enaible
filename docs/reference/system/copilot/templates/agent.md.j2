{%- macro map_claude_tools_to_copilot(allowed_tools) -%}
{%- set copilot_tools = [] -%}
{%- if allowed_tools -%}
  {%- if allowed_tools is string -%}
    {%- set normalized = allowed_tools.replace(',', ' ').replace(';', ' ') -%}
    {%- set tool_list = normalized.split() -%}
  {%- else -%}
    {%- set tool_list = allowed_tools -%}
  {%- endif -%}
  {%- for tool in tool_list -%}
    {%- set tool_clean = tool.strip() -%}
    {%- if not tool_clean -%}
      {%- continue -%}
    {%- endif -%}
    {%- set base_name = tool_clean.split('(', 1)[0].strip().lower() -%}
    {%- if base_name in ['read', 'glob', 'ls', 'notebookread'] -%}
      {%- if 'read' not in copilot_tools -%}
        {%- set _ = copilot_tools.append('read') -%}
      {%- endif -%}
    {%- endif -%}
    {%- if base_name in ['grep'] -%}
      {%- if 'search' not in copilot_tools -%}
        {%- set _ = copilot_tools.append('search') -%}
      {%- endif -%}
    {%- endif -%}
    {%- if base_name in ['write', 'edit', 'multiedit', 'notebookedit'] -%}
      {%- if 'edit' not in copilot_tools -%}
        {%- set _ = copilot_tools.append('edit') -%}
      {%- endif -%}
    {%- endif -%}
    {%- if base_name in ['bash', 'bashoutput', 'killshell'] -%}
      {%- if 'terminal' not in copilot_tools -%}
        {%- set _ = copilot_tools.append('terminal') -%}
      {%- endif -%}
    {%- endif -%}
    {%- if base_name in ['websearch', 'webfetch'] -%}
      {%- if 'web' not in copilot_tools -%}
        {%- set _ = copilot_tools.append('web') -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}
  {%- if 'githubRepo' not in copilot_tools and ('read' in copilot_tools or 'search' in copilot_tools) -%}
    {%- set _ = copilot_tools.append('githubRepo') -%}
  {%- endif -%}
{%- endif -%}
{{ copilot_tools | tojson }}
{%- endmacro -%}

{%- macro map_claude_model_to_copilot(model) -%}
{%- if model -%}
  {%- if 'sonnet' in model.lower() or 'claude' in model.lower() -%}
claude-sonnet-4-5-20250929
  {%- elif 'haiku' in model.lower() -%}
claude-3-5-haiku-20241022
  {%- elif 'opus' in model.lower() -%}
claude-opus-4-20250514
  {%- else -%}
{{ model }}
  {%- endif -%}
{%- endif -%}
{%- endmacro -%}
---
name: {{ frontmatter.get('name', title.lower().replace(' ', '-')) }}
description: {{ frontmatter.get('description', title) | replace('\n', ' ') | trim }}
{%- set tools = map_claude_tools_to_copilot(frontmatter.get('allowed-tools', '')) -%}
{%- if tools and tools != '[]' %}
tools: {{ tools }}
{%- endif %}
{%- set model = map_claude_model_to_copilot(frontmatter.get('model', '')) -%}
{%- if model and model.strip() %}
model: {{ model.strip() }}
{%- endif %}
{%- if frontmatter.get('handoffs') %}
handoffs: {{ frontmatter.get('handoffs') | tojson }}
{%- endif %}
---

# {{ title }}

{{ body }}

{{ managed_sentinel }}
